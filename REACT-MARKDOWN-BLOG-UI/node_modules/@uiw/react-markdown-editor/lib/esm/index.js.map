{"version":3,"sources":["../../src/index.tsx"],"names":["classnames","React","CodeMirror","PreviewMarkdown","ToolBar","ToolBarMode","MarkdownEditor","container","editorClientHeight","preview","toolbarsMode","handleResize","isfullscreen","state","fullscreen","setEditorSize","getInstance","editor","onChange","data","value","props","updateSource","getValue","onClickMode","type","previewMarkdown","fullScreen","onClick","selection","getSelection","pos","getCursor","ch","replaceSelection","focus","setCursor","line","prefixCls","className","toolbars","visble","visbleEditor","previewProps","codemirrorProps","node","mode","pmd","show","hide","setSize","getScrollInfo","clientHeight","window","addEventListener","removeEventListener","nextProps","updateMode","document","body","style","overflow","PureComponent","displayName","defaultProps"],"mappings":"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","sourcesContent":["import classnames from 'classnames';\nimport * as React from \"react\";\nimport { IInstance } from './common/codemirror';\nimport { IProps } from './common/props';\nimport CodeMirror, { ICodeMirror } from './components/CodeMirror';\nimport PreviewMarkdown, { IPreviewMarkdown } from './components/PreviewMarkdown';\nimport ToolBar from './components/ToolBar';\nimport ToolBarMode, { IToolBarModeProps } from './components/ToolBarMode';\nimport './index.less';\n\nexport interface IMarkdownEditor extends IProps, ICodeMirror {\n  prefixCls?: string,\n  value?: string,\n  height?: number,\n  visble?: boolean,\n  visbleEditor?: boolean,\n  toolbars?: string[] | false,\n  toolbarsMode?: IToolBarModeProps['toolbarsMode'] | false,\n  previewProps?: IPreviewMarkdown['previewProps'];\n  options?: CodeMirror.EditorConfiguration,\n}\n\ninterface IMarkdownEditorState { }\n\nexport default class MarkdownEditor extends React.PureComponent<IMarkdownEditor, IMarkdownEditorState> {\n  public static displayName = 'MarkdownEditor';\n  public static defaultProps: IMarkdownEditor = {\n    onChange: () => null,\n    prefixCls: 'md-editor',\n    value: '',\n    visbleEditor: true,\n    visble: true,\n  };\n  public container!: HTMLDivElement;\n  public editorClientHeight!: number;\n  public preview!: PreviewMarkdown;\n  public toolbarsMode!: ToolBarMode;\n  public CodeMirror!: CodeMirror;\n  public render() {\n    const { prefixCls, className, toolbars, toolbarsMode, onChange, visble, visbleEditor, previewProps, ...codemirrorProps } = this.props;\n    return (\n      <div ref={(node: HTMLDivElement) => this.container = node}>\n        <div className={classnames(prefixCls, className)}>\n          <ToolBarMode ref={(mode: ToolBarMode) => this.toolbarsMode = mode} toolbarsMode={toolbarsMode} onClick={this.onClickMode} />\n          <ToolBar toolbars={toolbars} onClick={this.onClick} />\n          <div className={classnames(`${prefixCls}-content`)}>\n            {visbleEditor && (\n              <CodeMirror\n                visbleEditor={visbleEditor}\n                ref={this.getInstance}\n                {...codemirrorProps}\n                onChange={this.onChange}\n              />\n            )}\n            <PreviewMarkdown\n              visble={visble}\n              ref={(pmd: PreviewMarkdown) => this.preview = pmd}\n              value={this.props.value}\n              previewProps={previewProps}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  public componentDidMount() {\n    if (this.preview && this.CodeMirror) {\n      this.props.visble ? this.preview.show() : this.preview.hide();\n      this.CodeMirror.editor.setSize(this.props.visble ? '50%' : '100%');\n      const { clientHeight } = this.CodeMirror.editor.getScrollInfo();\n      this.editorClientHeight = clientHeight;\n      window.addEventListener('resize', this.handleResize, true);\n    }\n  }\n\n  public componentWillUnmount() {\n    window.removeEventListener('resize', this.handleResize, true);\n  }\n\n  public handleResize = () => {\n    const isfullscreen = this.toolbarsMode.state.fullscreen\n    if (isfullscreen) {\n      this.setEditorSize(isfullscreen);\n    }\n  }\n\n  public componentWillReceiveProps(nextProps: IMarkdownEditor) {\n    if (nextProps.visble !== this.props.visble) {\n      nextProps.visble ? this.preview.show() : this.preview.hide();\n      this.CodeMirror.editor.setSize(nextProps.visble ? '50%' : '100%');\n    }\n  }\n\n  public getInstance = (editor: CodeMirror) => {\n    if (editor) {\n      this.CodeMirror = editor;\n    }\n  }\n  private onChange = (editor: IInstance, data: CodeMirror.EditorChange, value: string) => {\n    const { onChange } = this.props as IMarkdownEditor;\n    if (onChange) {\n      if (this.preview) {\n        this.preview.updateSource(editor.getValue());\n      }\n      onChange(editor, data, editor.getValue());\n    }\n  }\n\n  private previewMarkdown() {\n    if (this.preview) {\n      this.preview.state.visble ? this.preview.hide() : this.preview.show();\n      this.toolbarsMode.updateMode('preview', !this.preview.state.visble);\n      this.CodeMirror.editor.setSize(this.preview.state.visble ? '100%' : '50%');\n    }\n  }\n\n  private fullScreen() {\n    const { prefixCls } = this.props;\n    if (this.toolbarsMode && this.container) {\n      const isfullscreen = !this.toolbarsMode.state.fullscreen\n      this.toolbarsMode.updateMode('fullscreen', isfullscreen);\n      this.container.className = isfullscreen ? classnames(`${prefixCls}-fullscreen`) : '';\n      document.body.style.overflow = isfullscreen ? 'hidden' : 'initial';\n      this.setEditorSize(isfullscreen);\n    }\n  }\n\n  private setEditorSize(isfullscreen: boolean) {\n    const clientHeight = document.body.clientHeight;\n    this.CodeMirror.editor.setSize(this.preview.state.visble ? '50%' : '100%', isfullscreen ? clientHeight - 33 : this.editorClientHeight);\n  }\n\n  private onClickMode = (type: string) => {\n    if (type === 'preview') {\n      this.previewMarkdown();\n      return;\n    }\n    if (type === 'fullscreen') {\n      this.fullScreen();\n      return;\n    }\n  }\n\n  private onClick = (type: string) => {\n    const selection = this.CodeMirror.editor.getSelection();\n    const pos = this.CodeMirror.editor.getCursor();\n    let value = '';\n    // 'header', 'strike', 'underline', 'olist', 'ulist', 'todo', 'link', 'image', 'quote', 'preview'\n    if (type === 'bold') {\n      value = selection ? `**${selection}**` : `****`;\n      pos.ch = selection ? pos.ch : pos.ch + 2;\n    }\n    if (type === 'italic') {\n      value = selection ? `*${selection}*` : `**`;\n      pos.ch = selection ? pos.ch : pos.ch + 1;\n    }\n    if (type === 'header') {\n      value = selection ? `# ${selection}` : '# ';\n      pos.ch = selection ? pos.ch : pos.ch + 2;\n    }\n    if (type === 'strike') {\n      value = selection ? `~~${selection}~~` : '~~~~';\n      pos.ch = selection ? pos.ch : pos.ch + 2;\n    }\n    if (type === 'underline') {\n      value = selection ? `<u>${selection}</u>` : '<u></u>';\n      pos.ch = selection ? pos.ch : pos.ch + 3;\n    }\n    if (type === 'olist') {\n      value = selection ? `- ${selection}` : '- ';\n      pos.ch = selection ? pos.ch : pos.ch + 2;\n    }\n    if (type === 'ulist') {\n      value = selection ? `1. ${selection}` : '1. ';\n      pos.ch = selection ? pos.ch : pos.ch + 3;\n    }\n    if (type === 'todo') {\n      value = selection ? `- [ ] ${selection}` : '- [ ] ';\n      pos.ch = selection ? pos.ch : pos.ch + 6;\n    }\n    if (type === 'link') {\n      value = '[连接说明](连接地址 \"连接标题\")';\n    }\n    if (type === 'image') {\n      value = selection ? `${selection} ![](图片地址 \"图片描述\")` : '![图片描述](图片地址 \"图片描述\")\\n';\n    }\n    if (type === 'quote') {\n      value = selection ? `> ${selection}` : '> ';\n      pos.ch = selection ? pos.ch : pos.ch + 2;\n    }\n    this.CodeMirror.editor.replaceSelection(value);\n    this.CodeMirror.editor.focus();\n    this.CodeMirror.editor.setCursor(pos.line, pos.ch);\n  }\n}"]}